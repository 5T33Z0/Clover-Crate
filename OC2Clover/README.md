# Converting OpenCore Properties to Clover
>Work In Progress!

This is for users planning to convert their working OpenCore Config to Clover. It’s an adaptation of the [**Clover Conversion Guide**](https://github.com/dortania/OpenCore-Install-Guide/tree/master/clover-conversion) – just the other way around (and a bit more in-depth). 

The most relevant sections for converting a OpenCore config to Clover and vice versa are: "ACPI", "Device Properties", "Kernel and Kext Patches" and "Quirks", which will be covered here.

## ACPI
In general, you can use the same SSDTs (.aml) in Clover as in OpenCore. But since Clover has a lot of built-in DSDT Patches, some of then (and accompanying renames required to make them work in OC) are unnecessary.

### ACPI > Add
Following is an incomplete list of .aml files not needed in Clover, since it provides DSDT `Fixes` for them:

- `SSDT-SBUS-MCHC.aml`&rarr; Use Fixes`AddMCHC`and`FixSBUS`instead
- `SSDT-HPET.aml` → Use Fixes `FixHPET`, `FixIPIC`, `FixTMR` and `FixRTC` instead. You also don’t need the accompanying rename `change_CRS to XCRS` which is required in OpenCore.
- `DTGP` doesn't have to be part of SSDT patches. It will be generated by activating `AddDTGP`
- … 

### ACPI > Delete
The ACPI > Delete section is meant for deleting certain Tables from ACPI (usually combined with other SSDTs to replace them, like SSDT-PM or SSDT-PLUG for example). 

In Clover Configurator, this section is located under ACPI > Drop Tables. These are the available Paramters:

| OpenCore        | Clover              |
|:----------------|:--------------------|
| Table Signature | Signature           |
| OEMTableID      | Type/Key > TableID  |
| TableLength     | Type/Key > Length   |
| All             | DropForAllOS        |
| Enabled         | Disabled            |
| Comment         | –                 |

**Example**: Dropping CPU Power Management tables

- In OCAT:</br>
![OCAT_del](https://user-images.githubusercontent.com/76865553/138651510-a9d179a5-b8e3-43a4-9aff-3b536fffbbd7.png)

- In Clover Configurator:</br>
![Clover_drop](https://user-images.githubusercontent.com/76865553/138651565-3998b445-6df6-49b7-aad1-6a8914f169ef.png)

**NOTES**:

- In Clover, you enter actual names whereas in OpenCore you have to use HEX values.
- In Clover, you have to decide bewteen using either `TableID` or `TableLength`, not both.

### ACPI > Patch
While Binary Renames work the same in OpenCore and Clover, you have a lot more options in OpenCore:

| OpenCore        | Clover    |
|:---------------:|:----------:|
| Comment         | Comment   |
| Find		        | Find      |
| Replace         | Replace   |
| Base            | use [TgtBridge](https://github.com/5T33Z0/Clover-Crate/tree/main/ACPI#tgtbridge) instead|
| Enabled         | Disabled  |
| Table Signature | –       |
| OEMTableID      | –       |  
| TableLength     | –       |
| Mask            | –       |
| ReplaceMask     | –       |
| Count           | –       |
| Limit           | –       | 
| Skip            | –       |
| BaseSkip        | –       |

In Clover you also have the option "RenameDevices" which works the same as the `Base` Parameter in OpenCore with the difference that it is limited to devices:</br>
![Ren_Dev](https://user-images.githubusercontent.com/76865553/138651675-a51e51df-8249-4a79-8d75-c9de401e268c.png)

In OCAT you enter the path to a device in the `base` field (don't forget to enable them):</br>
![Dev_base](https://user-images.githubusercontent.com/76865553/138652948-fc403674-e434-4980-8062-a1ae1e787ab6.png)

### ACPI > Quirks 

| OpenCore          | Clover      |
|:-----------------:|:-----------:|
| FadtEnableReset   | HaltEnabler |
| Normalize Headers | FixHeaders  |
| Reset Logo Status | ?           |
| Rebase Regions    | ?           |
| Reset HwSig			| ?           |
| SyncTableIDs      | ?           |

## DeviceProperties
In OCAT, devices are added or modified in a straight forward "DeviceProperties" section:</br>
![OCAT_Devprops](https://user-images.githubusercontent.com/76865553/138651900-29810b55-324d-48e8-8e97-fcdda6038612.png)

In Clover Configurator these are hidden bedind a button in a sub-section:</br>
![Devices](https://user-images.githubusercontent.com/76865553/138610651-c9d42248-d1b8-4e54-b16a-2819556ae60f.png)
Besides that they work the same and the data is interchangeable.

## Kernel
For users who want to convert their Kext and Kernel Patches from OpenCore to Clover. Note that Clover uses two different sections for patching: one for patching Kexts ("KextsToPatch") and one for Patching the Kernel (KernelToPatch), whereas in OpenCore this is handled in the same section ("Kernel > Patch").

### Kernel > Add
In Clover, you don't have to add Kexts to a list and you don't have to worry about the kext loading sequence either. Kext dependencies are hard-coded into Clover, so Lilu and VirtualSMC will always load first. 

Whereas in OpenCore you need to define which kext loads for which macOS version via `Min/MaxKernel` parameters, Clover determines this much more hands-on by using the EFI folder structure inside of `EFI\CLOVER\kexts\`:

- Kexts which should load for *any* macOS version must be placed in `kexts\other`. This is the main kexts folder (although the name doesn't imply that at all).
- Kexts which should load for specific macOS versions only, must be placed in folders corresponding to the use macOS version. For example `kexts\10.15` for Catalina, `kexts\11` for Big Sur, or `kexts\12` for macOS Monterey, etc.
- To disable a Kext, move it to `kexts\Off`.

This is a lot less cumbersome then having to set `MinKernel` and `MaxKernel` values for Kexts. On the other hand it makes updating kexts a bit more complicated since you have to look in any sub-folder. Plus, can lead to having some duplicate kexts so the overall size of the EFI grows unncessarily.

### Kernel > Patch
In Clover Configurator, you have to enter rules for patching kexts and Kernes in the "Kernel and Kext Patches" section. In the table below, you find the availabe options and differences in nomenclature:

| OpenCore    | Clover         |
|:-----------:|:--------------:|
| Identifier  | Name           |
| Base        | Procedure      |
| Comment     | Comment        |
| Find		    | Find           |
| Replace     | Replace        |
| Mask        | MaskFind       |
| ReplaceMask | MaskReplace    |
| –           | MaskStart      |
| –           | StartPattern   |
| –           | RangeFind      |
| MinKernel   | –°             |
| MaxKernel   | –°             |
| Count       | Count          |
| Limit       | –              |
| Skip        | Skip           |
| Enabled     | Disabled       |
| Arch        | –              |
| –           | MatchOS°       |
| –           | InfoPlistPatch |
| –           | RangeFind      |

`°` Although there are no equivalents to `MinKernel` and `MaxKernel` parameters in Clover, you could use `MatcOS`. Instead of a range of kernel versions you just use the macOS version(s) it applies to. For example: `10.13,10.14,10.15` (without blanks in between).

## NVRAM > Add

### 7C436110-AB2A-4BBB-A880-FE41995C9F82
From this UUID, you probably want to transfer:

- `boot-args`: Add these to "Boot" > "Arguments" in Clover
- `csr-active-config`: Needs to be added in "RtVariables" > "CsrActiveConfig". BUT you can't use this as is, since it's Endianness (or whatever it's called) differs from the form Clover uses. For example: `FF070000` is `0x7FF` in Clover. You have to convert it: 
	
	1. Drop the last four digits (zeros); you get `FF07`
	2. Split the 4 remaining digts into pairs of two: `FF` `07`
	3. Swap the positions of the 1st and 2nd pair; you get: `07` `FF`
	4. Drop the `0`; you get: `7FF`
	6. Enter this value in "RtVariables" > `CsrActiveConfig`
	7. The resulting HEX value should look like this: `0x7FF` 

**NOTE**: To calculate your own csr bitmask, you can use my [**Clover Calculators**](https://github.com/5T33Z0/Clover-Crate/tree/main/Xtras) spreadsheet, which also helps understanding the whole choncept a lot better.

## Quirks
This is one of the most important aspects of your config. In OpenCore there are ACPI Quirks, Booter Quirks, Kernel Quirks and UEFI Quirks. A lot of them are combined in Clover's "Quirks" section. 

For more details on how OpenCore's Quirks are implemented into Clover, please refer to the Chapters [**"Quirks"**](https://github.com/5T33Z0/Clover-Crate/tree/main/Quirks) and [**Upgrading Clover for macOS 11+ compatibility**](https://github.com/5T33Z0/Clover-Crate/tree/main/Update_Clover).

### Kernel > Quirks
While most of OpenCore's Kernel Patches are located in Clover's Quirks section, the following are located under Kernel and Kext Patches instead:

| OpenCore (Kernel > Quirks) | Clover (Kernel and Kext Patches)|
|:---------------------------|:--------------------------------|
|AppleCpuPmCfgLock           | AppleIntelCPUPM
|AppleXcpmCfgLock            | KernelPM
|AppleXcpmExtraMsrs          | KernelXCPM
|CustomSMBIOSGuid            | DellSMBIOSPatch
|DisableRtcChecksum          | AppleRTC
|LapicKernelPanic            | Kernel LAPIC
|PanicNoKextDump             | PanicNoKextDump

## PlatformInfo > Generic
If you want to use your SMBIOS data from "PlatformInfo > Generic" in Clover, you have to use different fields and section to do so. This can be a bit confusing due to naming differences as well as the number of fields available in both configs.

In order to use the SMBIOS data in OpenCore and Clover, do the following:

1. Copy the Data from the following fields to Clover Configurator's "SMBIOS" and "RtVariables" sections:</br> 

	| OpenCore (PlatformInfo > Generic) | Clover (SMBIOS)      |
	|-----------------------------------|----------------------|
	| SystemProductName                 | ProductName          |
	| SystemUUID                        | SmUUID               |
	| ROM                               | ROM (in RtVariables) |
	| N/A in "Generic"                  | Board-ID             |
	| SystemSerialNumber                | Serial Number        |
	| MLB                               | Board Serial Number and MLB (in RtVariables)|
2. Next, tick the "Update Firmware Only" box.
3. From the Dropdown Menu next to it to, select same Model you used for   "ProductName". This updates other fields like BIOS and Firmware.
4. Save config and boot via Clover.

**IMPORTANT**

- If you did everything correct, you won't have to enter your AppleID Password after switching bootloaders and macOS will let you know, that "This AppleID is now used with this device" or something like that.
- But if macOS asks for your AppleID Password and Mail passwords etc. after switching bootloades, you did something wrong. In this casem you should reboot into OpenCore instead and check again. Otherwise you are registering your computer as a new/different Mac.
